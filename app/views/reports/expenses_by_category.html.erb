<h1 class="mb-4"><i class="fas fa-tags"></i> Expenses by Category</h1>

<div class="card shadow-sm mb-4">
  <div class="card-body">
    <%= form_with url: expenses_by_category_reports_path, method: :get, local: true, class: 'row g-3' do |f| %>
      <div class="col-md-4">
        <%= f.label :start_date, 'Start Date', class: 'form-label' %>
        <%= f.date_field :start_date, value: @start_date, class: 'form-control' %>
      </div>
      <div class="col-md-4">
        <%= f.label :end_date, 'End Date', class: 'form-label' %>
        <%= f.date_field :end_date, value: @end_date, class: 'form-control' %>
      </div>
      <div class="col-md-4 d-flex align-items-end">
        <%= f.submit 'Generate Report', class: 'btn btn-primary w-100' %>
      </div>
    <% end %>
  </div>
</div>

<div class="card shadow-sm mb-4">
  <div class="card-header bg-primary text-white">
    <h4 class="mb-0">Total: $<%= number_with_precision(@total, precision: 2) %></h4>
  </div>
  <div class="card-body">
    <% if @category_breakdown.any? %>
      <% @category_breakdown.sort_by { |_, amount| -amount }.each do |category, amount| %>
        <div class="mb-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="fw-bold"><%= category %></span>
            <span class="fw-bold text-primary">$<%= number_with_precision(amount, precision: 2) %></span>
          </div>
          <div class="progress" style="height: 25px;">
            <div class="progress-bar bg-primary" role="progressbar"
                 style="width: <%= (amount / @total * 100).round(2) %>%"
                 aria-valuenow="<%= (amount / @total * 100).round(2) %>"
                 aria-valuemin="0"
                 aria-valuemax="100">
              <%= number_with_precision((amount / @total * 100), precision: 1) %>%
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <p class="text-center text-muted">No expenses found for the selected date range.</p>
    <% end %>
  </div>
</div>

<div class="mt-3">
  <%= link_to reports_path, class: 'btn btn-secondary' do %>
    <i class="fas fa-arrow-left"></i> Back to Reports
  <% end %>
</div>
